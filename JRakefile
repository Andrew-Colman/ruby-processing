# -*- encoding: utf-8 -*-
require 'psych'

if !File.exist? './lib/video.jar'
  begin
  CONFIG_FILE_PATH=File.expand_path('~/.rp5rc')
  RB_CONFIG = (Psych.load_file(CONFIG_FILE_PATH))
  core= "#{RB_CONFIG["PROCESSING_ROOT"]}/core/library/core.jar"
  FileUtils.cp(core, './lib')
  video= "#{RB_CONFIG["PROCESSING_ROOT"]}/modes/java/libraries/video/library/video.jar"
  FileUtils.cp(video, './lib')
  rescue
    raise 'WARNING: you must set path to processing-2.2.1 as PROCESSING_ROOT in .rp5rc to compile'
  end
end

WARNING = <<-EOS 
   WARNING: you need to copy processings 'core.jar' & 'video.jar' to lib folder 
   for the ext compile (video.jar required since video_event library)
      
EOS


if RUBY_PLATFORM =~ /java/
  # -*- ruby -*-
  require 'rake/javaextensiontask'
  
  Rake::JavaExtensionTask.new('monkstone') do |ext|
    jars = FileList['lib/*.jar']
    warn WARNING unless FileTest.exist? 'lib/video.jar'
    ext.classpath = jars.map {|x| File.expand_path x}.join ':'
    ext.name = 'rpextras'
    ext.debug = true
    ext.lib_dir = 'lib'
    ext.source_version='1.7'
    ext.target_version='1.7'
  end
end
